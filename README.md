My working code. You'll need the automation and the helpers for every room you want to control via this automation. 
![HA frontend]()
